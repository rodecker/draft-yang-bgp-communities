<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc [
<!ENTITY I-D.ietf-netmod-rfc6991-bis PUBLIC "" "https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.draft-ietf-netmod-rfc6991-bis-17.xml">
<!ENTITY IEEE.1003-2.1992 PUBLIC "" "https://bib.ietf.org/public/rfc/bibxml6/reference.R.IEEE.1003-2.1992.xml">
<!ENTITY RFC1912 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.1912.xml">
<!ENTITY RFC1930 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.1930.xml">
<!ENTITY RFC1997 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.1997.xml">
<!ENTITY RFC2119 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC3688 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3688.xml">
<!ENTITY RFC4360 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4360.xml">
<!ENTITY RFC4384 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4384.xml">
<!ENTITY RFC6020 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6020.xml">
<!ENTITY RFC7942 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7942.xml">
<!ENTITY RFC7950 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7950.xml">
<!ENTITY RFC7951 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7951.xml">
<!ENTITY RFC8092 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8092.xml">
<!ENTITY RFC8174 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC8195 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8195.xml">
<!ENTITY RFC8340 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8340.xml">
<!ENTITY RFC8792 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8792.xml">
<!ENTITY RFC9595 PUBLIC "" "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.9595.xml">
]>

<?rfc strict="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>

<rfc xmlns:xi="http://www.w3.org/2001/XInclude"
     category="std"
     docName="draft-ietf-grow-yang-bgp-communities-04"
     ipr="trust200902"
     xml:lang="en"
     submissionType="IETF"
     version="3">

  <front>

    <title abbrev="BGP Community YANG">A YANG Data Model for BGP Communities</title>

    <seriesInfo name="Internet-Draft" value="draft-ietf-grow-yang-bgp-communities-04"/>

    <author fullname="Martin Pels" initials="M" surname="Pels">
      <organization>RIPE NCC</organization>
      <address>
        <postal>
          <country>NL</country>
        </postal>
        <email>mpels@ripe.net</email>
      </address>
    </author>

    <date />

    <abstract>
      <t>
        This document defines a YANG data model for the structured specification of BGP communities.
        The model provides operators with a way to publish their locally defined BGP communities in a standardized format.
      </t>
    </abstract>
  </front>

  <middle>

    <section title="Introduction" anchor="intro">

      <t>
        ISPs use BGP communities to add information to their prefix announcements or to let customers influence routing behaviour inside the network of the ISP.
        Each ISP defines for itself which BGP communities to support and how the structure of these communities should be interpreted.
        This document provides a YANG<xref target="RFC7950"/> module for describing the structure and meaning of BGP communities<xref target="RFC1997"/>, Extended BGP communities<xref target="RFC4360"/> and Large BGP communities<xref target="RFC8092"/>.
        ISPs can use this standardized format to publish their community definitions.
        <xref target="rationale"/> elaborates on further advantages of using such a standardized format.
      </t>

    </section>

    <section title="Terminology" anchor="terminology">
       <t>
         The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
         NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
         "MAY", and "OPTIONAL" in this document are to be interpreted as
         described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/>
         when, and only when, they appear in all capitals, as shown here.
      </t>
      <t>
        The meaning of the symbols in tree diagrams are defined in <xref target="RFC8340"/>.
      </t>
    </section>

    <section title="Rationale" anchor="rationale">

      <t>
        ISPs may define various BGP communities that have local significance within their network.
        These communities could be used to add miscellaneous information to a prefix announcement.
        For example, a community "64501:1:528" may signify that the AS with ASN 64501 is originating a prefix from a point of presence in The Netherlands (ISO 3166-1 code 528).
        Communities could be used to allow customers of an ISP to control the routing behavior of their prefixes inside the ISP.
        For example, a community "64501:4:64498" attached to a prefix advertised to AS64501 by a customer may be interpreted by AS64501 to mean that this prefix must not be propagated to AS64498.
      </t>
      <t>
        For both use cases it is necessary for the ISP to communicate the meaning of their locally defined communities to others.
        Currently this is typically done by publishing a list of communities on a web page, or as a remark inside an "autnum" object in the Internet Routing Registry.
        This makes it cumbersome to determine whether and where an ISP publishes community information.
        The lack of a well-defined structure makes it hard to create a standardized publishing mechanism, and to develop tools for automatically parsing community information and eventually triggering configuration actions.
      </t>
      <t>
        The purpose of the YANG model defined in this document is to provide a standardized format for publishing community definitions.
        These definitions help applications to interpret the structure and purpose of BGP communities.
        For example, looking glasses may use the published definitions to parse communities seen in BGP announcements and display their meaning.
        Another potential use case is in generating routing policy configurations based on community definitions published by an upstream ASN.
        This could be achieved automatically using external tooling to generate router configurations, or inside a router's command-line interface by importing the definitions and providing the CLI-user with available choices for manual configuration.
      </t>
      <t>
        This document only describes a data model for the publishing format of community definitions.
        The publishing location and publishing mechanism used are outside the scope of this specification.
        The data model does not make any assumption about the protocol used to publish/retrieve formatted data following the model.
      </t>

    </section>

    <section title="Tree view" anchor="tree">

      <t>
        The following tree diagram provides an overview of the "ietf-bgp-communities" data model.
      </t>
      <sourcecode>
module: ietf-bgp-communities
  +--rw bgp-communities
     +--rw serial?        uint32
     +--rw uri?           inet:uri
     +--rw description?   string
     +--rw contact-url?   inet:uri
     +--rw contact* [email-address]
     |  +--rw email-address          inet:email-address
     |  +--rw name?                  string
     |  +--rw role?                  string
     |  +--rw organization?          string
     |  +--rw organizational-unit?   string
     +--rw regular* [name]
     |  +--rw name            community-name
     |  +--rw category?       community-category
     |  +--rw description?    community-description
     |  +--rw global-admin    two-octet-as-number
     |  +--rw local-admin
     |     +--rw format?   local-admin-format
     |     +--rw field* [name]
     |        +--rw name           field-name
     |        +--rw length?        uint8
     |        +--rw pattern        field-pattern
     |        +--rw description?   field-description
     +--rw extended* [name]
     |  +--rw name              community-name
     |  +--rw category?         community-category
     |  +--rw description?      community-description
     |  +--rw type              uint8
     |  +--rw subtype           uint8
     |  +--rw (global-admin)
     |  |  +--:(asn)
     |  |  |  +--rw asn?   two-octet-as-number
     |  |  +--:(asn4)
     |  |     +--rw asn4?   inet:as-number
     |  +--rw local-admin
     |     +--rw format?   local-admin-format
     |     +--rw field* [name]
     |        +--rw name           field-name
     |        +--rw length?        uint8
     |        +--rw pattern        field-pattern
     |        +--rw description?   field-description
     +--rw large* [name]
        +--rw name                 community-name
        +--rw category?            community-category
        +--rw description?         community-description
        +--rw global-admin         inet:as-number
        +--rw local-data-part-1
        |  +--rw format?   local-admin-format
        |  +--rw field* [name]
        |     +--rw name           field-name
        |     +--rw length?        uint8
        |     +--rw pattern        field-pattern
        |     +--rw description?   field-description
        +--rw local-data-part-2
           +--rw format?   local-admin-format
           +--rw field* [name]
              +--rw name           field-name
              +--rw length?        uint8
              +--rw pattern        field-pattern
              +--rw description?   field-description
      </sourcecode>
    </section>

    <section title="YANG Module" anchor="module">
      <t>
        This section contains the complete YANG module defined in this document.
      </t>
      <t>
        Several elements in this module use data types from <xref target="I-D.ietf-netmod-rfc6991-bis"/>.
        These data types are represented with the prefix "inet".
      </t>
      <sourcecode>
<![CDATA[
<CODE BEGINS> file "ietf-bgp-communities@2025-06-03.yang"

module ietf-bgp-communities {
...
}
<CODE ENDS>
]]>
      </sourcecode>

    </section>

    <section title="Operational guidelines" anchor="recommendations">

      <section title="Publishing guidelines" anchor="recommendations.publishing">
        <t>
          Operators SHOULD only publish BGP community definitions for networks they control.
          This may include communities where the Global Administrator field contains a private ASN, if this community has a local meaning inside the network of the publisher.
        </t>
        <t>
          When publishing community definitions with overlapping field patterns, these definitions MUST be ordered from most to least preferred.
          This ensures parsers can perform deterministic matching (see <xref target="recommendations.parsing"/>).
          For example, a definition for a single community "64500:123" needs to be specified before a definition that matches a covering range of communities "64500:*".
        </t>
      </section>

      <section title="Parsing guidelines" anchor="recommendations.parsing">
        <t>
          A published BGP community definition can be used by parsers to display information about a received community.
          If a received community matches multiple published community definitions, the first matching definition in the published order takes precedence.
        </t>
        <t>
          Parsers that use published community definitions from multiple operators SHOULD NOT attempt to match received communities where the Global Administrator field contains a private ASN, unless they have some method to determine which published definition is the authoritative one.
        </t>
        <t>
          By default, communities are compared using the decimal representation of the fields. If "format" for a Local Administrator or Local Data Part is set to "binary", the fields in the received community are converted to strings of zeros and ones before comparison.
        </t>
        <t>
          Applications that parse these community definitions SHOULD reject objects that do not comply with the rules described in this document.
          Furthermore, parsers SHOULD check that the sum of the specified Local Administrator or Local Data Part field lengths in each community definition does not exceed the local part size of the specified community type.
          For example, a Regular BGP community definition with format "decimal" containing a field of length 4 and a field of length 2 would be illegal, as the Local Administrator field has a maximum length of 65535 (5 digits).
        </t>
      </section>

    </section>

    <section title="IANA considerations" anchor="iana">

      <section title="YANG Namespace Registration" anchor="iana.xml">
        <t>
          This document registers the following XML namespace URN in the "IETF
          XML Registry", following the format defined in <xref target="RFC3688"/>:
        </t>
        <sourcecode>
URI: urn:ietf:params:xml:ns:yang:ietf-bgp-communities
Registrant Contact: The IESG.
XML: N/A, the requested URI is an XML namespace.
        </sourcecode>
      </section>

      <section title="YANG Module Registration" anchor="iana.yang">
        <t>
          This document registers the following YANG module in the "YANG Module Names" registry <xref target="RFC6020"/>:
        </t>
        <sourcecode>
Name: ietf-bgp-communities
Maintained by IANA? N
Namespace: urn:ietf:params:xml:ns:yang:ietf-bgp-communities
Prefix: bgp-comm
Reference: RFC YYYY
RFC-EDITOR: please update YYYY with this RFC ID
        </sourcecode>
      </section>

      <section title="YANG SID Allocation" anchor="iana.sid">
        <t>
          This document registers the following entry in the "IETF YANG SID" registry <xref target="RFC9595"/>:
        </t>
        <sourcecode>
SID range entry point: TBD
SID range size: 100
YANG module name: ietf-bgp-communities
Reference: RFC YYYY
RFC-EDITOR: please update YYYY with this RFC ID
        </sourcecode>
      </section>

    </section>

    <section title="Implementation status" anchor="implementation">

      <t>
        RFC-EDITOR: Please remove this section and the accompanying reference(s) before publication.
      </t>

     <t>
       This section records the status of known implementations of the protocol defined by this specification at the time of posting of this Internet-Draft, and is based on a proposal described in <xref target="RFC7942"/>.
       The description of implementations in this section is intended to assist the IETF in its decision processes in progressing drafts to RFCs.
       Please note that the listing of any individual implementation here does not imply endorsement by the IETF.
       Furthermore, no effort has been spent to verify the information presented here that was supplied by IETF contributors.
       This is not intended as, and must not be construed to be, a catalog of available implementations or their features.
       Readers are advised to note that other implementations may exist.
     </t>

     <t>
       According to <xref target="RFC7942"/>, "this will allow reviewers and working groups to assign due consideration to documents that have the benefit of running code, which may serve as evidence of valuable experimentation and feedback that have made the implemented protocols more mature.
       It is up to the individual working groups to use this information as they see fit".
     </t>

      <section title="Publishing implementations" anchor="implementation.publishing">

        <t>
          The following networks are known to publish BGP community definitions according to this specification.
        </t>

        <table anchor="table.publishing">
          <name>Publishing implementations</name>
          <thead>
            <tr>
              <th>ASN</th>
              <th>Publication URI</th>
              <th>YANG model revision</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>197000</td>
              <td><eref target="https://www-static.ripe.net/dynamic/draft-ietf-grow-yang-bgp-communities/as197000.json">as197000.json</eref></td>
              <td>2024-06-15</td>
            </tr>
            <tr>
              <td>25152</td>
              <td><eref target="https://www-static.ripe.net/dynamic/draft-ietf-grow-yang-bgp-communities/as25152.json">as25152.json</eref></td>
              <td>2024-06-15</td>
            </tr>
          </tbody>
        </table>

      </section>

      <section title="Parser implementations" anchor="implementation.parsing">

        <t>
          The following known parser implementations exist.
        </t>

        <table anchor="table.parsing">
          <name>Parser implementations</name>
          <thead>
            <tr>
              <th>Name</th>
              <th>YANG model revision</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><eref target="https://github.com/NLNOG/lg.ring.nlnog.net/">NLNOG Looking Glass</eref></td>
              <td>2024-06-15</td>
            </tr>
          </tbody>
        </table>

      </section>

    </section>
    
    <section title="Security considerations" anchor="security">

      <t>
        The YANG module described in this document may be used to specify BGP community definitions in different encoding formats, such as XML, JSON or CBOR.
        Applications that parse these community definitions SHOULD reject objects that do not comply with the rules described in this document.
        Furthermore, parsers SHOULD check that the sum of the specified Local Administrator or Local Data Part field lengths in each community definition does not exceed the local part size of the specified community type.
      </t>
      <t>
        The "contact-url" element may contain a link to an untrusted webpage.
        Parsers MAY opt to render the URL as plain text rather than a clickable link, to prevent inadvertent exposure of information by users of the rendered output.
      </t>
      <t>
        Several elements of the "contact" list may contain personal data covered by privacy-laws.
        Publishers MUST ensure that the elements email-address" and "name" do not contain any privacy-sensitive information.
      </t>

    </section>

  </middle>

  <back>

    <references title="Normative References" anchor="normative">

      &I-D.ietf-netmod-rfc6991-bis;
      &RFC1930;
      &RFC1997;
      &RFC4360;
      &RFC7950;
      &RFC8092;
      &RFC9595;

    </references>

    <references title="Informative References" anchor="informative">

      &IEEE.1003-2.1992;
      &RFC1912;
      &RFC2119;
      &RFC3688;
      &RFC4384;
      &RFC6020;
      &RFC7942;
      &RFC7951;
      &RFC8174;
      &RFC8195;
      &RFC8340;
      &RFC8792;

    </references>

    <section title="JSON Examples" anchor="examples">

      <t>
        This section shows example use cases for the YANG module defined in this document, using JSON encoding (see <xref target="RFC7951"/>).
        The examples contain long lines that may be folded, as described in <xref target="RFC8792"/>.
      </t>

      <section title="RFC8195 Selective NO_EXPORT definition" anchor="examples.rfc8195">
        <t>
          A JSON definition for the example Large BGP community described in <xref target="RFC8195"/>, section 4.1.1 looks as follows.
        </t>
        <sourcecode>
=============== NOTE: '\' line wrapping per RFC 8792 ================

{
  "ietf-bgp-communities:bgp-communities": {
    "serial": 2023080101,
    "uri": "http://example.net/peering/communities",
    "description": "BGP Community example for ASN-Based Selective \
NO_EXPORT",
    "contact": [
      {
        "email-address": "noc@example.net",
        "name": "Example.net contact",
        "role": "Administrative contact",
        "organization": "Example.net",
        "organizational-unit": "NOC"
      }
    ],
    "large": [
      {
        "name": "RFC8195-NOEXPORT-ASN",
        "category": "action",
        "description": "Do not export route to ASN",
        "global-admin": 65539,
        "local-data-part-1": {
          "field": [
            {
              "name": "Function",
              "pattern": "4",
              "description": "ASN-No-Export"
            }
          ]
        },
        "local-data-part-2": {
          "field": [
            {
              "name": "ASN",
              "pattern": ".*"
            }
          ]
        }
      }
    ]
  }
}
        </sourcecode>
      </section>

      <section title="RFC4384 Data Collection definition" anchor="examples.rfc4384">
        <t>
          A JSON definition for the example Regular and Extended BGP communities described in <xref target="RFC4384"/>, section 4 looks as follows.
        </t>
        <sourcecode>
=============== NOTE: '\' line wrapping per RFC 8792 ================

{
  "ietf-bgp-communities:bgp-communities": {
    "serial": 2023080101,
    "uri": "http://example.net/peering/communities",
    "description": "BGP Community example for Data Collection",
    "contact-url": "https://example.net/contact",
    "regular": [
      {
        "name": "RFC4384-REGULAR-ORIGIN-OC/FJ",
        "description": "A national route over a terrestrial link \
from the Fiji Islands",
        "global-admin": 10876,
        "local-admin": {
          "format": "binary",
          "field": [
            {
              "name": "Region",
              "length": 5,
              "pattern": "00010",
              "description": "OC"
            },
            {
              "name": "Satellite",
              "length": 1,
              "pattern": "0"
            },
            {
              "name": "Country",
              "length": 10,
              "pattern": "0011110010",
              "description": "FJ"
            }
          ]
        }
      }
    ],
    "extended": [
      {
        "name": "RFC4384-EXTENDED-ORIGIN-OC/FJ",
        "description": "A national route over a terrestrial link \
from the Fiji Islands",
        "type": 0,
        "subtype": 8,
        "asn": 10876,
        "local-admin": {
          "format": "binary",
          "field": [
            {
              "name": "Reserved",
              "length": 16,
              "pattern": "0000000000000000"
            },
            {
              "name": "Region",
              "length": 5,
              "pattern": "00010",
              "description": "OC"
            },
            {
              "name": "Satellite",
              "length": 1,
              "pattern": "0"
            },
            {
              "name": "Country",
              "length": 10,
              "pattern": "0011110010",
              "description": "FJ"
            }
          ]
        }
      }
    ]
  }
}
        </sourcecode>
      </section>

    </section>

    <section title="Acknowledgements" anchor="acknowledgements">

      <t>
        The author would like to thank Jeffrey Haas, Luuk Hendriks, Jasper den Hertog, Teun Vink, Tom Petch, Dale Carder, Mohamed Boucadair and Ladislav Lhotka for contributing ideas and feedback to this document.
      </t>

    </section>

  </back>

</rfc>
